(()=>{"use strict";var t,e;!function(t){t.GRID_ROWS="grid-template-rows",t.GRID_COLS="grid-template-columns",t.GRID_ROW_START="grid-row-start",t.GRID_ROW_END="grid-row-end",t.GRID_COL_START="grid-column-start",t.GRID_COL_END="grid-column-end",t.WIDTH="width",t.HEIGHT="height",t.BACKGROUND="background",t.COLOR="color",t.GAP="gap"}(t||(t={}));class r{constructor(t){this.html=document.createElement(t),this.styles=new Map}getHtml(){return this.html}addClasses(t){this.foreachString(t,(t=>this.html.classList.add(t)))}removeClasses(t){this.foreachString(t,(t=>this.html.classList.remove(t)))}addChilds(t){t.forEach((t=>this.html.appendChild(t.html)))}addStyle(t){for(let e of t)this.styles.set(e[0],e[1]);this.updateCss()}removeStyle(t){for(let e of t)this.styles.has(e)&&this.styles.delete(e);this.updateCss()}setText(t){this.html.innerText=t}setGridPosition(e,r){this.addStyle([[t.GRID_ROW_START,`${e.x}`],[t.GRID_ROW_END,`${r.x}`],[t.GRID_COL_START,`${e.y}`],[t.GRID_COL_END,`${r.y}`]])}foreachString(t,e){t.forEach((t=>e(t)))}updateCss(){let t="";this.styles.forEach(((e,r)=>{t+=`${r}:${e};`})),this.html.style.cssText=t}}!function(t){t.DIV="DIV",t.BUTTON="BUTTON",t.H1="H1",t.H2="H2",t.H3="H3",t.P="P",t.TABLE="TABLE",t.CNV="CANVAS"}(e||(e={}));const i=e,s=class extends r{constructor(t="",e=""){super(i.DIV),this.addClasses(["grid"])}setGrid(e,r){this.addStyle([[t.GRID_ROWS,e],[t.GRID_COLS,r]])}};class o{static init(){let t=document.documentElement;this.height=t.clientHeight,this.width=t.clientWidth,window.addEventListener("resize",this.init)}static calcHeightPercernt(t){return this.height/t}static calcWidthPercernt(t){return this.width/t}}class n{constructor(t,e){this.x=t,this.y=e}static create(t,e){return new n(t,e)}}var a;!function(t){t[t.TEXTURE_SQUARE=0]="TEXTURE_SQUARE",t[t.DEFAULT_LOADING=1]="DEFAULT_LOADING",t[t.LINES=2]="LINES"}(a||(a={}));class h{constructor(){h.allObjects.push(this)}static get AllObjects(){return this.allObjects}}h.allObjects=[];class c extends h{constructor(){super(...arguments),this.pType=a.TEXTURE_SQUARE,this.size=n.create(1,1),this.position=n.create(0,0)}setProgram(t){this.program=t}update(){throw new Error("Method not implemented.")}draw(){this.program?.ctx.bufferData(this.program.ctx.ARRAY_BUFFER,new Float32Array(this.getVertexPosition()),this.program.ctx.STATIC_DRAW),this.program?.ctx.useProgram(this.program.Prgrm),this.program?.setOrtho(),this.program?.ctx.drawElements(this.program?.ctx.TRIANGLE_STRIP,5,this.program?.ctx.UNSIGNED_SHORT,0)}getVertexPosition(){let t=this.size.y/2,e=this.size.x/2;return[this.position.x-e,this.position.y+t,this.position.x-e,this.position.y-t,this.position.x+e,this.position.y-t,this.position.x+e,this.position.y+t]}}class l{create(t){if(t===a.TEXTURE_SQUARE)return new c;throw Error("Object type is not defined!")}}Math.PI;const d="#version 300 es\n\n    uniform mat4 m_projection;\n    in vec2 position;\n    in vec2 texCoord;\n    out vec2 tc;\n    void main() {\n        tc = texCoord;\n        gl_Position = m_projection * vec4(position, 1.0, 1.0);\n    }",x="#version 300 es\n\n    precision highp float;\n    out vec4 color;\n    uniform sampler2D tex;\n    in vec2 tc;\n    void main() {\n      color = texture(tex, tc);\n    }";class m{get ctx(){return this.context}get Prgrm(){return this.program}constructor(t,e){this.arrayBuffers=new Map,this.context=t,this.program=this.createProgram(e),this.projectionMatrix=this.context.getUniformLocation(this.program,"m_projection"),this.calculateOrtho=this.setOrthoMatrix(3.4),this.arrayBuffers.set("texCoord",this.createArrayBuffer("texCoord",2)),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,0]),this.context.STATIC_DRAW),this.arrayBuffers.set("position",this.createArrayBuffer("position",2)),this.indexBuffer=this.createIndexBuffer([0,1,2,3,0]),this.setTexture("123")}setOrtho(){this.context.uniformMatrix4fv(this.projectionMatrix,!1,this.calculateOrtho)}createProgram(t){let e=this.createShader(this.context.VERTEX_SHADER,d),r=this.createShader(this.context.FRAGMENT_SHADER,x);return this.initProgram(t,e,r)}createShader(t,e){let r=this.context.createShader(t);if(this.context.shaderSource(r,e),this.context.compileShader(r),this.context.getShaderParameter(r,this.context.COMPILE_STATUS))return r;throw console.warn(this.context.getShaderInfoLog(r)),this.context.deleteShader(r),new Error(`Shader \n ${e} \n is broken!`)}initProgram(t,e,r){let i=this.context.createProgram();if(this.context.attachShader(i,e),this.context.attachShader(i,r),this.context.linkProgram(i),this.context.getProgramParameter(i,this.context.LINK_STATUS))return i;throw console.warn(this.context.getProgramInfoLog(i)),new Error(this.context.getProgramInfoLog(i))}createArrayBuffer(t,e){let r=this.context.createBuffer();this.context.bindBuffer(this.context.ARRAY_BUFFER,r);let i=this.context.getAttribLocation(this.program,t);return this.context.enableVertexAttribArray(i),this.context.vertexAttribPointer(i,e,this.context.FLOAT,!1,0,0),r}createIndexBuffer(t){let e=this.context.createBuffer();return this.context.bindBuffer(this.context.ELEMENT_ARRAY_BUFFER,e),this.context.bufferData(this.context.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.context.STATIC_DRAW),e}setOrthoMatrix(t){let e=Math.min(o.width,o.height),r=Math.max(o.width,o.height)/(e/t),i=((s=new Float32Array(16))[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s);var s;return function(t,e,r,i,s,o,n){var a=1/(e-r),h=1/(i-s);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-.1,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*h,t[14]=-0,t[15]=1}(i,e==o.width?-t/2:-r/2,e==o.width?t/2:r/2,e==o.height?-t/2:-r/2,e==o.height?t/2:r/2),i}setTexture(t){let e=new Image;e.src="/texture/cross.png",e.onload=()=>{let t=this.context.getUniformLocation(this.program,"tex"),r=this.context.createTexture();this.context.activeTexture(this.context.TEXTURE0+0),this.context.bindTexture(this.context.TEXTURE_2D,r),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.CLAMP_TO_EDGE),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,e),this.context.enable(this.context.BLEND),this.context.blendFunc(this.context.SRC_ALPHA,this.context.SRC_ALPHA_SATURATE),this.context.uniform1i(t,0)}}}class g{constructor(t){this.createdPrograms=new Map,this.context=t}getProgram(t){return this.createdPrograms.has(t)?this.createdPrograms.get(t):this.createProgram(t)}createProgram(t){let e=new m(this.context,t);return this.createdPrograms.set(t,e),e}}class E{constructor(t){this.gl=t.getContext("webgl2"),this.h=t.height,this.w=t.width,this.gl.viewport(0,0,this.w,this.h),this.programKeeper=new g(this.gl),this.objectFactory=new l,[n.create(-1.1,1.1),n.create(0,1.1),n.create(1.1,1.1),n.create(-1.1,0),n.create(0,0),n.create(1.1,0),n.create(-1.1,-1.1),n.create(0,-1.1),n.create(1.1,-1.1)].forEach((t=>{let e=this.objectFactory.create(a.TEXTURE_SQUARE);e.setProgram(this.programKeeper.getProgram(a.TEXTURE_SQUARE)),e.position=t}))}draw(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),h.AllObjects.forEach((t=>t.draw()))}}class T extends r{constructor(t,e){super(i.CNV),this.setSize(t,e),this.context=new E(this.html)}setSize(t,e){this.html.setAttribute("width",`${t}`),this.html.setAttribute("height",`${e}`)}draw(){this.context.draw()}}class p{constructor(){this.mainGrid=new s,this.panelGrid=new s,o.init(),this.mainInit(),this.mainGrid.addChilds([this.panelGrid])}mainInit(){document.body.appendChild(this.mainGrid.getHtml());let t=o.calcHeightPercernt(15);this.mainGrid.setGrid(`${t}px ${o.height-t}px`,`${o.width}px`),this.createPanel(t),Telegram.WebApp.expand()}createPanel(e){this.panelGrid.setGrid(`${e}px`,`${o.width-e}px ${e}px`),this.panelGrid.setGridPosition(n.create(1,1),n.create(2,3)),this.panelGrid.addStyle([[t.BACKGROUND,Telegram.WebApp.themeParams.button_color]]);let i=new r("DIV"),s=new r("DIV");i.addStyle([[t.BACKGROUND,Telegram.WebApp.themeParams.bg_color],[t.COLOR,Telegram.WebApp.themeParams.text_color]]),i.setText(Telegram.WebApp.initDataUnsafe.user?.username),i.addClasses(["flex","f_center"]),s.addStyle([[t.COLOR,Telegram.WebApp.themeParams.button_text_color]]),s.setText("S"),s.addClasses(["flex","f_center"]),this.game=new T(o.width,o.height-e),this.game.setGridPosition(n.create(2,1),n.create(3,2)),this.panelGrid.addChilds([i,s]),this.mainGrid.addChilds([this.game])}draw(){this.game instanceof T&&this.game.draw()}}window.addEventListener("load",(()=>{try{var t=new p;function e(){t.draw(),requestAnimationFrame(e)}e()}catch(r){document.body.innerHTML=r}}))})();